# Generated by: tyk-ci/wf-gen
# Generated on: Tue Jan  4 15:29:12 UTC 2022

# Generation commands:
# ./pr.zsh -p -base aws/TD-664-r4-0 -branch aws/TD-664-r4-0 -title sync m4 templates -repos tyk
# m4 -E -DxREPO=tyk

# Check the documentation at http://goreleaser.com
# This project needs CGO_ENABLED=1 and the cross-compiler toolchains for
# - arm64
# - amd64

# One build required for goreleaser, this is not used subsequently
builds:
  - id: std
    flags:
      - -tags=goplugin
    ldflags:
      - -X gateway.VERSION={{.Version}} -X gateway.commit={{.FullCommit}} -X gateway.buildDate={{.Date}} -X gateway.builtBy=goreleaser
    goos:
      - linux
    goarch:
      - amd64

# This disables archives
archives:
  - format: binary

dockers:
# Build plugin-compiler
- ids:
    - std
  image_templates:
    - tykio/tyk-plugin-compiler:{{ .Tag }}-el7
    - "tykio/tyk-plugin-compiler:v{{ .Major }}.{{ .Minor }}{{.Prerelease}}"
  build_flag_templates:
    - "--label=org.opencontainers.image.created={{.Date}}"
    - "--label=org.opencontainers.image.title=tyk-plugin-compiler"
    - "--label=org.opencontainers.image.revision={{.FullCommit}}"
    - "--label=org.opencontainers.image.version={{.Version}}"
    - "--build-arg=TYK_GW_TAG={{ .Tag }}"
    - "--build-arg=GOLANG_CROSS={{ .Env.GOLANG_CROSS }}"
  goarch: amd64
  goos: linux
  dockerfile: images/plugin-compiler/Dockerfile
  extra_files:
    - "images/plugin-compiler/"
    - "go.mod"
