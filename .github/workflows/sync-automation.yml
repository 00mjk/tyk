# Generated by: gromit policy
# Generated on: 2021-05-24 18:04:21.789092781 +0000 UTC

# This workflow should only exist in release-3.0.5
# Missing files are silently ignored. Most of the time this is what we want, older repos may not have some files
# If releng/release-3-lts does not exist, it will be created

name: Sync automation

on:
  push:
    paths:
      - bin/unlock-agent.sh
      - .goreleaser.yml
      - Dockerfile.std
      - Dockerfile.slim
      - aws/byol.pkr.hcl
      - .github/workflows/release.yml
      - .github/workflows/del-env.yml
      - integration/terraform/outputs.tf
      - install/before_install.sh
      - install/post_install.sh
      - install/post_remove.sh

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          depth: 1

      - name: sync release-3.0.5 â†’ releng/release-3-lts
        run: |
          git fetch origin refs/heads/releng/release-3-lts:refs/heads/releng/release-3-lts && git checkout releng/release-3-lts
          git config --local user.email "policy@gromit"
          git config --local user.name "Bender"
          git checkout --theirs origin/release-3.0.5 -- bin/unlock-agent.sh
          git checkout --theirs origin/release-3.0.5 -- .goreleaser.yml
          git checkout --theirs origin/release-3.0.5 -- Dockerfile.std
          git checkout --theirs origin/release-3.0.5 -- Dockerfile.slim
          git checkout --theirs origin/release-3.0.5 -- aws/byol.pkr.hcl
          git checkout --theirs origin/release-3.0.5 -- .github/workflows/release.yml
          git checkout --theirs origin/release-3.0.5 -- .github/workflows/del-env.yml
          git checkout --theirs origin/release-3.0.5 -- integration/terraform/outputs.tf
          git checkout --theirs origin/release-3.0.5 -- install/before_install.sh
          git checkout --theirs origin/release-3.0.5 -- install/post_install.sh
          git checkout --theirs origin/release-3.0.5 -- install/post_remove.sh
          git commit -m "[CI] Backport release automation from release-3.0.5" -m "${{ github.event.head_commit.message }}"
          git push origin releng/release-3-lts
          echo "::debug::syncd from release-3.0.5 to releng/release-3-lts"
